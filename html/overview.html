<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xsens DOT PC SDK API: Overview of the Xsens DOT Device API (Getting Started)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="xsens.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xsenslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xsens DOT PC SDK API<span id="projectnumber">&#160;2022.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('overview.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Overview of the Xsens DOT Device API (Getting Started) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="s_introduction"></a>
Introduction</h1>
<p >This document gives an introduction to the Xsens DOT Device API. It serves as a starting point for software developers interested in assessing the basis of the SDK.</p>
<h1><a class="anchor" id="s_setup"></a>
Set-up</h1>
<p >As can be seen, the host application developer can choose to use a Python, Java, C#, C or C++ interface. The C++ interface is not available in compiled form but is provided as part of the SDK as source code that is incorporated in the C header files. This C++ interface code implements a convenience wrapper around the C API. This means that the developer does not have to deal with memory management (i.e. easy object-lifetime management) as the class implementation takes care of this. <br  />
<br  />
 The API comprises of two C-interface libraries that are supplied for MS Windows and Linux, 64 bit. These are:</p>
<ul>
<li>XsTypes that contains generic types (vectors, matrices, quaternions, etc.) and some basic operations on those types. </li>
<li>XsensDot PC SDK that contains the access to functionality as implemented in Xsens DOT devices.</li>
</ul>
<p>The Xsens DOT Device API library depends on the XsTypes, while XsTypes is an independent library.</p>
<p >The remainder of this document focuses on the C++ interface of the Xsens DOT Device API only. For examples which will show how to import and use the API with all the available interfaces have a look at the <a class="el" href="p_examples.html">Code Examples</a> page.<br  />
 </p>
<h2><a class="anchor" id="ss_mainClasses"></a>
Important Classes of the C++ interface</h2>
<p >The following four classes available in the C++ interface are classes that are extensively used by a host application. Knowing what these classes are about will give the developer a starting point for implementing a basic application. If you go through the examples you will find these classes are used throughout all the examples. <br  />
<br  />
 </p><ul>
<li><a class="el" href="struct_xs_dot_connection_manager.html" title="High level Xsens DOT management class.">XsDotConnectionManager</a>: The central class of the Xsens DOT Device API. It handles the administration of devices and global settings. It keeps track of all opened devices as <a class="el" href="struct_xs_dot_device.html" title="A pointer to an XsDotDevice object.">XsDotDevice</a> objects. An application creates a single <a class="el" href="struct_xs_dot_connection_manager.html" title="High level Xsens DOT management class.">XsDotConnectionManager</a> object at startup and will use it to access devices and their data.</li>
</ul>
<ul>
<li><a class="el" href="struct_xs_dot_device.html" title="A pointer to an XsDotDevice object.">XsDotDevice</a>: Provides an interface to control and configure a device. It will also process data that arrives for the particular device.</li>
</ul>
<ul>
<li><a class="el" href="class_xs_dot_callback.html" title="Structure that contains callback functions for the Xsens DOT PC SDK API.">XsDotCallback</a>: Provides event handling. If the host application needs to receive events from XDDA a sub class of <a class="el" href="class_xs_dot_callback.html" title="Structure that contains callback functions for the Xsens DOT PC SDK API.">XsDotCallback</a> is created that overrides the virtual event functions the application needs to handle. An instance of the subclass is registered with the <a class="el" href="struct_xs_dot_connection_manager.html" title="High level Xsens DOT management class.">XsDotConnectionManager</a> object. More information regarding callback implementation can be found in the <a class="el" href="overview.html#s_concurrency">Callback System and Concurrency</a> section.</li>
</ul>
<ul>
<li><a class="el" href="struct_xs_port_info.html" title="Contains a descriptor for opening a communication port to an Xsens device.">XsPortInfo</a>: Contains the info of a detected device during scanning. Most importantly, it contains the Bluetooth address which will be used to establish the connection.</li>
</ul>
<h1><a class="anchor" id="s_workflow"></a>
API/Code Workflow</h1>
<h2><a class="anchor" id="ss_abstract_programFlow"></a>
Abstract Program Flow</h2>
<p >This section describes the typical program flow of an application using the XDDA. Refer to the <a class="el" href="p_examples.html">Code Examples</a> page for some simple application examples reflecting the flow described here.<br  />
The image below describes the code flow in a more abstracted way. The phases used in the actual implementation are described in more detail below with examples that are closer to the actual C++ implementation.</p>
<div class="doxyimage"><div class="image">
<img src="abstract_code_workflow.png" alt=""/>
<div class="caption">
Abstract Code Workflow</div></div>
</div><h2><a class="anchor" id="ss_programFlow"></a>
Detailed Recommended Program Flow</h2>
<p >An application that wants to process data from one or more Xsens DOT device will roughly follow the following steps</p>
<ul>
<li>
Startup phase  <ol>
<li>
<p class="startli">Initialize XDDA </p><div class="groupText"> The application starts with the creation of an <a class="el" href="struct_xs_dot_connection_manager.html" title="High level Xsens DOT management class.">XsDotConnectionManager</a> object using the <a class="el" href="struct_xs_dot_connection_manager.html#a60d8c8f803743705e396987e7533ef0f" title="Construct a new XsDotConnectionManager* object. Clean it up with the destruct() function or delete th...">XsDotConnectionManager::construct</a> function. </div><p class="endli"></p>
</li>
<li>
<p class="startli">Setup callbacks </p><div class="groupText">With event based data handling the application is signaled with information. To enable this a callback object must be registered. The application creates an object derived from <a class="el" href="class_xs_dot_callback.html" title="Structure that contains callback functions for the Xsens DOT PC SDK API.">XsDotCallback</a> and overrides functions of interest, for instance onAdvertisementFound or onLiveDataAvailable. The object is registered with XDDA using the XsDotConnectionManager::addCallbackHandler function. </div><p class="endli"></p>
</li>
<li>
<p class="startli">Discover devices </p><div class="groupText"> The application starts the discovery of devices by calling <a class="el" href="struct_xs_dot_connection_manager.html#a7b339fa31d7c4a4933c50a192937755b" title="Enable the BluetoothScanner and start a ScanTask collecting advertisements.">XsDotConnectionManager::enableDeviceDetection</a>. This enables Bluetooth device detection. The <a class="el" href="group___callbacks.html#gaf87bff2153b09247d0b8e43bfa07ccc6" title="Called when an Xsens DOT device advertisement was received.">XsDotCallback::onAdvertisementFound</a> callback will be used to signal new received advertisements. </div><p class="endli"></p>
</li>
<li>
<p class="startli">Open devices of interest </p><div class="groupText"> The port information (<a class="el" href="struct_xs_port_info.html">XsPortInfo</a>) obtained in the previous step is used to open devices of interest using the <a class="el" href="struct_xs_dot_connection_manager.html#aee49b425b979c7af3b42b8669bdaeab4" title="Open a communication channel using the details in the supplied XsPortInfo structure.">XsDotConnectionManager::openPort</a> function. </div><p class="endli"></p>
</li>
<li>
<p class="startli">Configure measurement mode and start measurement </p><div class="groupText"> If needed the application configures the connected devices. Through the <a class="el" href="struct_xs_dot_connection_manager.html#a826eca666f7b7a0f35013196c67e4b38" title="Returns the XsDotDevice interface object associated with the supplied deviceId.">XsDotConnectionManager::device</a> function the application obtains <a class="el" href="struct_xs_dot_device.html" title="A pointer to an XsDotDevice object.">XsDotDevice</a> instances required to do the configuration. Typical configuration actions are setting sync settings or enabling measurement mode with a certain payload. Depending on what data you need from the Xsens DOT you can choose different payloads. You can also request the list of available filter profiles using getAvailableFilterProfiles and read and change this with onboardFilterProfile and setOnboardFilterProfile respectively. More information on how to use these can be found in the function documentation or the examples. These can be configured by setting the desired <a class="el" href="group__enums.html#gae8101e0798e9fdddaea052bb21119b7a">XsPayloadMode</a> by using startMeasurement with a certain payload. The device will then stream data in real-time containing the chosen payload. For more information on the available payload modes please refer to the page <a class="el" href="p_payload_modes.html">Xsens DOT Payload Modes</a> . </div><p class="endli"></p>
</li>
</ol>
</li>
<li>
Processing phase  <ol>
<li>
<p class="startli">Handle incoming data </p><div class="groupText"> The onLiveDataAvailable function of the callback object registered in the startup phase will be called whenever new data is available from the device. The function gets a pointer to the newly available <a class="el" href="struct_xs_data_packet.html" title="Contains an interpreted data message. The class provides easy access to the contained data through it...">XsDataPacket</a> as parameter. The <a class="el" href="struct_xs_data_packet.html#a5d5de9e35c85b44c0158e1389ada848a" title="Return the device ID associated with the data packet.">XsDataPacket::deviceId</a> function is used to determine from which device the packet is received. Refer to <a class="el" href="overview.html#s_concurrency">Callback System and Concurrency</a> for a more in-depth view on event based data handling </div><p class="endli"></p>
</li>
<li>
<p class="startli">Check for completion </p><div class="groupText"> The application checks the conditions required for process completion, these are application defined. If the conditions are met the Exit phase is entered </div><p class="endli"></p>
</li>
</ol>
</li>
<li>
Exit phase  <ol>
<li>
<p class="startli">Close open devices </p><div class="groupText"> All open devices are closed. The application uses the <a class="el" href="struct_xs_dot_connection_manager.html#ad6b4b0ec85fbebaed540ec03da279d60" title="Close the port that matches portinfo.">XsDotConnectionManager::closePort</a> function on each opened device to do this or the <a class="el" href="struct_xs_dot_connection_manager.html#ad7d2424e054855cfcb0669b38a25d7e6" title="Close all ports and files.">XsDotConnectionManager::close</a> function to close all open devices. </div><p class="endli"></p>
</li>
<li>
Clean up XDDA <div class="groupText"> The application releases the <a class="el" href="struct_xs_dot_connection_manager.html" title="High level Xsens DOT management class.">XsDotConnectionManager</a> object created at startup using the <a class="el" href="struct_xs_dot_connection_manager.html#ad5b97360e1e931da98aa2cb7a6205d6f" title="Destruct a XsDotConnectionManager object and free all memory allocated for it.">XsDotConnectionManager::destruct</a> function. </div> </li>
</ol>
</li>
</ul>
<h1><a class="anchor" id="s_callbacks"></a>
Callbacks and Concurrency</h1>
<p >In the image below a high level overview of the Xsens DOT PC SDK and the callback system can be found. The External callbacks in the image are there for visualization purposes. This distinction is made to explain some of the internal workings (in the actual code these are not subclasses of <a class="el" href="class_xs_dot_callback.html" title="Structure that contains callback functions for the Xsens DOT PC SDK API.">XsDotCallback</a>). When you as a user create an application you use the previously described important classes. With these classes you can for example do the following: </p><ul>
<li>Create a ConnectionManager and start scanning </li>
<li>The BLE scanner (Internal part of the SDK) will trigger an <a class="el" href="class_xs_dot_callback.html" title="Structure that contains callback functions for the Xsens DOT PC SDK API.">XsDotCallback</a> when an advertising DOT Device is found. </li>
<li>You could consider this as an "external scanner callback" which can subsequently used in the PC Application.</li>
</ul>
<div class="doxyimage"><div class="image">
<img src="overview.png" alt=""/>
<div class="caption">
High Level Overview with Callbacks</div></div>
</div><h2><a class="anchor" id="s_concurrency"></a>
Callback System and Concurrency</h2>
<p >The Xsens DOT Device SDK implements a concurrent system. This means that: </p><ul>
<li>The XDDA functions are implemented in a thread-safe way. </li>
<li>The XDDA framework supports asynchronous events.</li>
</ul>
<p>To make the XDDA functions thread-safe, data manipulation is controlled tightly and care is taken that function calls are non-blocking. This last point is also achieved by caching all information that would be required from the device.<br  />
<br  />
 The asynchronous events are handled by implementing a <em>callback</em> object. This can be achieved through creating a class inherited from <a class="el" href="class_xs_dot_callback.html" title="Structure that contains callback functions for the Xsens DOT PC SDK API.">XsDotCallback</a> that overrides the virtual event functions. The callback object is registered in the <a class="el" href="struct_xs_dot_connection_manager.html" title="High level Xsens DOT management class.">XsDotConnectionManager</a> object. An example for device detection and it's related callback are illustrated in the figure below.<br  />
<br  />
</p>
<div class="doxyimage"><div class="image">
<img src="xdpc_callback_example_flow.png" alt=""/>
<div class="caption">
Example Callback Flow</div></div>
</div><p >Another example use of the callback system was described in <a class="el" href="overview.html#ss_programFlow">Detailed Recommended Program Flow</a> In this example the application starts the measurements at the devices using the <a class="el" href="struct_xs_dot_device.html#a674fefcdcef8102312837efbf9c0fe47" title="Start measurement for this device, using the passed XsPayloadMode. Measuremnt data will be provided i...">XsDotDevice::startMeasurement</a> function. From this point on the connected device will generate data. Data will be sent over its Bluetooth connection. Each <a class="el" href="struct_xs_dot_device.html" title="A pointer to an XsDotDevice object.">XsDotDevice</a> object has set up listeners to handle incoming payload data.<br  />
<br  />
 After the data is read and converted from incoming byte arrays, the worker thread will call the onLiveDataAvailable() callback function. This call will end up in the overloaded function of the callback object implemented by the application developer.<br  />
<br  />
 It is good practice to take any actions based on callbacks in a separate thread. This can be achieved by using an OS messaging mechanism to forward the event to the applications' main event loop. The callback function runs in the context of <a class="el" href="struct_xs_dot_device.html" title="A pointer to an XsDotDevice object.">XsDotDevice</a> worker thread and problems can occur if XDDA functions that change the state of the XDDA (such as openPort or close) or the application (such as showing a window) are called from within the callback handler. For example, most GUI-toolkits require that all operations are performed from a single thread. Also, any time-consuming processing (e.g. graphical display) that is performed inside the callback function will block the worker thread, which causes a delay in data-processing and must therefore be prevented.<br  />
<br  />
 Another important consideration is the data that is passed as parameter of the callback function. To prevent unnecessary copying and thereby reducing time spent in callback functions, the data is given as a pointer to an <a class="el" href="struct_xs_data_packet.html" title="Contains an interpreted data message. The class provides easy access to the contained data through it...">XsDataPacket</a> maintained by the XDDA. For the application, this data is only valid within the scope of the callback function. The calling worker thread remains in control of the data and is responsible for cleaning it up when it is no longer necessary. The developer can create an effective implementation in which only the data is copied that is actually required by the application and only create a message to be sent to the application thread containing this specific data. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
